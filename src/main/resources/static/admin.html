<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>EjectCloud Admin</title>\n    <link rel=\"icon\" type=\"image/png\" href=\"images/twitch-logo-transparent.png\">\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        table { border-collapse: collapse; width: 100%; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #f2f2f2; }\n        .form-group { margin: 10px 0; }\n        input, button { padding: 5px; margin: 2px; }\n        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }\n    </style>\n</head>\n<body>\n    <h1>EjectCloud - Админ панель</h1>\n    \n    <div class=\"section\">\n        <h2>Создать пользователя</h2>\n        <div class=\"form-group\">\n            <input id=\"newUsername\" placeholder=\"Username\" />\n            <input id=\"newQuota\" type=\"number\" placeholder=\"Квота (байты)\" value=\"1073741824\" />\n            <input id=\"newDisplayName\" placeholder=\"Отображаемое имя\" />\n            <button onclick=\"createUser()\">Создать</button>\n        </div>\n    </div>\n    \n    <div class=\"section\">\n        <h2>Пользователи</h2>\n        <button onclick=\"loadUsers()\">Обновить список</button>\n        <table id=\"usersTable\">\n            <thead>\n                <tr>\n                    <th>ID</th>\n                    <th>Username</th>\n                    <th>Telegram ID</th>\n                    <th>Квота (MB)</th>\n                    <th>Использовано (MB)</th>\n                    <th>Свободно (MB)</th>\n                    <th>Действия</th>\n                </tr>\n            </thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    \n    <div class=\"section\">\n        <h2>Настройки</h2>\n        <div class=\"form-group\">\n            <label>Время неактивности (минуты):</label>\n            <input id=\"inactiveMinutes\" type=\"number\" value=\"30\" />\n            <button onclick=\"updateSetting('token.inactive.minutes', document.getElementById('inactiveMinutes').value)\">Сохранить</button>\n        </div>\n    </div>\n\n    <script>\n        function loadUsers() {\n            fetch('/admin/api/users')\n                .then(r => r.json())\n                .then(users => {\n                    const tbody = document.querySelector('#usersTable tbody');\n                    tbody.innerHTML = '';\n                    users.forEach(user => {\n                        const row = tbody.insertRow();\n                        const quotaMB = Math.round(user.quotaBytes / 1024 / 1024);\n                        const usedMB = Math.round(user.usedBytes / 1024 / 1024);\n                        const freeMB = quotaMB - usedMB;\n                        \n                        row.innerHTML = `\n                            <td>${user.id}</td>\n                            <td>${user.username}</td>\n                            <td>${user.telegramId || '-'}</td>\n                            <td>${quotaMB}</td>\n                            <td>${usedMB}</td>\n                            <td>${freeMB}</td>\n                            <td>\n                                <input type=\"number\" id=\"quota_${user.id}\" value=\"${quotaMB}\" style=\"width:80px\" />\n                                <button onclick=\"updateQuota(${user.id})\">Изменить квоту</button>\n                            </td>\n                        `;\n                    });\n                })\n                .catch(e => alert('Ошибка загрузки: ' + e.message));\n        }\n        \n        function createUser() {\n            const username = document.getElementById('newUsername').value;\n            const quota = document.getElementById('newQuota').value;\n            const displayName = document.getElementById('newDisplayName').value;\n            \n            if (!username || !quota) {\n                alert('Заполните обязательные поля');\n                return;\n            }\n            \n            const params = new URLSearchParams();\n            params.append('username', username);\n            params.append('quotaBytes', quota);\n            if (displayName) params.append('displayName', displayName);\n            \n            fetch('/admin/api/users', {\n                method: 'POST',\n                body: params\n            })\n            .then(r => {\n                if (!r.ok) return r.text().then(t => { throw new Error(t); });\n                return r.json();\n            })\n            .then(() => {\n                alert('Пользователь создан');\n                loadUsers();\n                document.getElementById('newUsername').value = '';\n                document.getElementById('newDisplayName').value = '';\n            })\n            .catch(e => alert('Ошибка: ' + e.message));\n        }\n        \n        function updateQuota(userId) {\n            const quotaMB = document.getElementById(`quota_${userId}`).value;\n            const quotaBytes = quotaMB * 1024 * 1024;\n            \n            const params = new URLSearchParams();\n            params.append('userId', userId);\n            params.append('quotaBytes', quotaBytes);\n            \n            fetch('/admin/api/quota', {\n                method: 'POST',\n                body: params\n            })\n            .then(r => {\n                if (!r.ok) throw new Error('Ошибка сервера');\n                alert('Квота обновлена');\n                loadUsers();\n            })\n            .catch(e => alert('Ошибка: ' + e.message));\n        }\n        \n        function updateSetting(key, value) {\n            const params = new URLSearchParams();\n            params.append('key', key);\n            params.append('value', value);\n            \n            fetch('/admin/api/settings', {\n                method: 'POST',\n                body: params\n            })\n            .then(r => {\n                if (!r.ok) throw new Error('Ошибка сервера');\n                alert('Настройка сохранена');\n            })\n            .catch(e => alert('Ошибка: ' + e.message));\n        }\n        \n        // Загрузить пользователей при открытии страницы\n        loadUsers();\n    </script>\n</body>\n</html>